# ============================================================================
# GigaChad GRC - Environment Configuration Example
# ============================================================================
# IMPORTANT: Copy this file to .env before starting the application
#            NEVER commit your .env file to version control!
#
# To create your .env file:
#   cp .env.example .env
#
# For production deployments, see: env.example.production
# ============================================================================

NODE_ENV=development

# =============================================================================
# Security Secrets (REQUIRED - Generate unique values!)
# =============================================================================
# Generate these using the commands below. NEVER use the example values!
#
# Generate encryption key:    openssl rand -hex 32
# Generate JWT/session secret: openssl rand -base64 64
# Generate passwords:          openssl rand -base64 24
# =============================================================================

# 64-character hex key for encrypting sensitive data
# Generate: openssl rand -hex 32
ENCRYPTION_KEY=generate-a-64-char-hex-key-using-openssl-rand-hex-32

# Base64 secret for JWT token signing (64+ characters)
# Generate: openssl rand -base64 64
JWT_SECRET=generate-a-secure-jwt-secret-using-openssl-rand-base64-64

# Base64 secret for session encryption (64+ characters)
# Generate: openssl rand -base64 64
SESSION_SECRET=generate-a-secure-session-secret-using-openssl-rand-base64-64

# =============================================================================
# Database Configuration
# =============================================================================
POSTGRES_USER=grc
# Generate: openssl rand -base64 24
POSTGRES_PASSWORD=change-this-to-a-secure-password
POSTGRES_DB=gigachad_grc
DATABASE_URL=postgresql://grc:change-this-to-a-secure-password@localhost:5433/gigachad_grc

# =============================================================================
# Redis Configuration
# =============================================================================
# Generate: openssl rand -base64 24
REDIS_PASSWORD=change-this-to-a-secure-redis-password
REDIS_URL=redis://:change-this-to-a-secure-redis-password@localhost:6380

# =============================================================================
# MinIO (Object Storage)
# =============================================================================
MINIO_ROOT_USER=minioadmin
# Generate: openssl rand -base64 24
MINIO_ROOT_PASSWORD=change-this-to-a-secure-minio-password
MINIO_ENDPOINT=localhost
MINIO_PORT=9000

# =============================================================================
# Authentication (Keycloak)
# =============================================================================
KEYCLOAK_ADMIN=admin
# Change this for production!
KEYCLOAK_ADMIN_PASSWORD=change-this-admin-password
KEYCLOAK_REALM=grc
# Keycloak client secret for service-to-service auth (REQUIRED)
# Generate: openssl rand -base64 32
KEYCLOAK_ADMIN_CLIENT_SECRET=change-me-in-production
# Enable for development only - MUST be false in production!
USE_DEV_AUTH=false

# =============================================================================
# Phishing Simulation
# =============================================================================
# Secret for signing phishing tracking tokens (REQUIRED for phishing module)
# Generate: openssl rand -base64 32
PHISHING_TRACKING_SECRET=change-me-in-production

# =============================================================================
# CORS Configuration
# =============================================================================
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:5174

# =============================================================================
# Rate Limiting
# =============================================================================
RATE_LIMIT_ENABLED=true
# Window size in milliseconds (60000ms = 1 minute)
RATE_LIMIT_WINDOW_MS=60000
# Maximum requests per window per IP address
# This is a per-minute limit (based on RATE_LIMIT_WINDOW_MS above)
# 100 requests/minute = ~1.67 requests/second - suitable for most API usage
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# Security: Custom Integration Code Execution
# =============================================================================
# SECURITY WARNING: Custom code execution allows users to run arbitrary JavaScript
# code via new Function(). This is a significant security risk and is DISABLED by default.
# 
# Only enable if you:
# 1. Have strong network isolation for the controls service
# 2. Trust all users with access to custom integrations
# 3. Have proper monitoring and audit logging in place
#
# When disabled, users can still use "visual mode" for custom integrations.
ENABLE_CUSTOM_CODE_EXECUTION=false

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=info

# =============================================================================
# Frontend Configuration
# =============================================================================
VITE_API_URL=http://localhost:3001
VITE_ENABLE_DEV_AUTH=false
VITE_ENABLE_AI_MODULE=true
# Optional: CDN URL for training content (used for postMessage origin validation)
# VITE_TRAINING_CDN_URL=https://training.example.com

# =============================================================================
# Optional: AI Integration
# =============================================================================
# OPENAI_API_KEY=sk-your-openai-api-key-here
# ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# =============================================================================
# Optional: Slack Integration
# =============================================================================
# SLACK_ENABLED=false
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your/webhook/url

# =============================================================================
# Metrics Endpoint Security
# =============================================================================
# SECURITY: The /metrics endpoint exposes system internals and must be protected.
# In production, at least one of these authentication methods is required.
#
# Option 1: Bearer token authentication (recommended for automated scrapers)
# Generate: openssl rand -base64 32
# METRICS_AUTH_TOKEN=your-secure-metrics-token
#
# Option 2: Basic authentication (for manual access)
# METRICS_AUTH_USER=prometheus
# METRICS_AUTH_PASSWORD=your-secure-password
#
# Option 3: IP allowlist (comma-separated, for internal Prometheus)
# METRICS_ALLOWED_IPS=127.0.0.1,::1,172.17.0.1
#
# Disable auth in development only (never in production!)
# METRICS_AUTH_DISABLED=true

# =============================================================================
# Audit Log Integrity Protection
# =============================================================================
# SECURITY: HMAC-SHA256 signing key for audit log tamper detection.
# Each audit log entry is signed and hash-chained to the previous entry.
# This enables detection of any modifications to the audit trail.
#
# REQUIRED in production for compliance with audit requirements.
# Generate: openssl rand -base64 32
# AUDIT_LOG_HMAC_KEY=your-secure-hmac-key-here

# =============================================================================
# Security Event Alerting
# =============================================================================
# SECURITY: Real-time alerts for security events (failed logins, unauthorized
# access, privilege changes, data exports, brute force attacks, etc.)
#
# Enable security alerting
# SECURITY_ALERTS_ENABLED=true
#
# Minimum severity to trigger alerts: info, low, medium, high, critical
# SECURITY_ALERTS_THRESHOLD=high
#
# Slack webhook for security alerts
# SECURITY_ALERTS_SLACK_WEBHOOK=https://hooks.slack.com/services/xxx/yyy/zzz
#
# Email recipients for security alerts (comma-separated)
# SECURITY_ALERTS_EMAIL_RECIPIENTS=security@example.com,ops@example.com

# =============================================================================
# Malware Scanning for File Uploads
# =============================================================================
# SECURITY: Scan uploaded files for malware before storage/processing.
# Supports ClamAV (local) and VirusTotal (cloud-based) scanners.
#
# Enable malware scanning (RECOMMENDED for production)
# MALWARE_SCAN_ENABLED=true
#
# Scan timeout in milliseconds
# MALWARE_SCAN_TIMEOUT_MS=30000
#
# Maximum file size for scanning (100MB default)
# MALWARE_SCAN_MAX_SIZE=104857600
#
# ClamAV Configuration (local scanner)
# Install: apt-get install clamav clamav-daemon
# CLAMAV_ENABLED=true
# CLAMAV_HOST=localhost
# CLAMAV_PORT=3310
#
# VirusTotal Configuration (cloud scanner)
# Note: Files are NOT uploaded to preserve confidentiality - hash lookup only
# VIRUSTOTAL_ENABLED=true
# VIRUSTOTAL_API_KEY=your-virustotal-api-key

# =============================================================================
# Backup Integrity Protection
# =============================================================================
# SECURITY: HMAC-SHA256 signing for backup integrity verification.
# Prevents restoring tampered or corrupted backups.
#
# Shared secret key for signing/verifying backups
# Generate: openssl rand -base64 32
# Must be the same on backup and restore systems!
# BACKUP_SIGNING_KEY=your-secure-signing-key
#
# Require valid signature for restore (RECOMMENDED for production)
# BACKUP_SIGNATURE_REQUIRED=true
